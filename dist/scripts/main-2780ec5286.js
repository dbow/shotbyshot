"use strict";function ShotCtrl(t,e,n,i,o,a,s,r,l,c,d){var u=this;this.id=a.current,this.next=a.getNext(),this.previous=a.getPrevious(),this.videoUrl=a.getVideoUrl(),this.shots=[],this.thumbsForTag={},c.pageview(window.location.href,document.title+" - Shot "+this.id),t.menuIsOn=!1,t.showMenuTab="shots",angular.element(document.body).removeClass("noscroll");var h=3e4;this.played=!1,this.play=function(){u.played=!0,u.backgroundOpacity=0,u.playing=!0,r.play(function(){u.stop(),d.autoScroll()})},this.stop=function(){u.playing=!1,r.resumeLoop(),u.backgroundOpacity=1,t.$apply()};var v=!0;this.id&&a.getShot(this.id).then(function(e){window.location.search.indexOf("installation")>=0&&i(function(){u.played||u.play()},h);var n=[{type:"introduction",shot:u.id,nav:"introduction",onEnter:function(){t.inView=!0,u.ready||i(function(){u.ready=!0},3e3),t.$apply()},onExit:function(){t.inView=!1,u.stop()}}],a=[{shot:u.id,type:"outro",next:u.next,onEnter:function(){window.location.search.indexOf("installation")>=0&&i(function(){v&&(l.scrollToSlide(u.slides[0]),o.go("shot",{shot:u.next||1}))},h)},onExit:function(){v=!1}}],r=n.concat(s.parse(e),a);u.annotations=e,u.slides=r,_.each(r,function(e){e.isNav=t.isNavSlide(e),e.isHeader=t.isHeaderSlide(e)})}),a.getThumbnails(0).then(function(e){t.thumbs=u.thumbs=e;var n=_.findIndex(e,function(t){return parseInt(t.slug,10)===u.id}),o=275,a=o*Math.floor(n/2);i(function(){document.querySelector(".nav-menu-shots").scrollTop=a},300)}),a.getTags(0).then(function(t){u.tags=_.map(_.sortBy(t,function(t){return-t.post_count}).slice(0,30),function(t){return t.title=t.title.replace(/\s/g,"&nbsp;"),t})}),t.isHeaderSlide=function(t){var e=["introduction","outro","author","photo","video","streetview","bg-video"];return _.contains(e,t.type)},t.isNavSlide=function(t){var e=["introduction","author","photo","video","streetview","main-title"];return _.contains(e,t.type)},t.scrollToSlide=function(t){l.scrollToSlide(t)},t.thumbnailForShot=function(t){return"/wp/wp-content/uploads/Shots_400px/"+t.slug+".png"},t.toggleMenu=function(){t.menuIsOn?(r.resumeLoop(),angular.element(document.body).removeClass("noscroll")):(r.pause(),angular.element(document.body).addClass("noscroll")),t.menuIsOn=!t.menuIsOn},t.toggleGlobalMenu=function(){t.globalIsOn?(r.resumeLoop(),angular.element(document.body).removeClass("noscroll")):(r.pause(),angular.element(document.body).addClass("noscroll")),t.globalIsOn=!t.globalIsOn},t.filterShots=function(e){e?u.thumbsForTag[e.id]?t.thumbs=u.thumbsForTag[e.id]:a.getAnnotationsForTag(e,0).then(function(n){var i={};_.each(n,function(t){t.categories.length&&(i[t.categories[0].id]=t.categories[0])}),t.thumbs=u.thumbsForTag[e.id]=_.toArray(i)}):t.thumbs=u.thumbs}}function ShotService(t,e,n,i,o,a){var s=this,r=parseInt(i.shot,10);this.current=isNaN(r)?0:r,this.getVideoUrl=function(){var t="http://cf.lossur.es/"+n("shot")(this.current)+".mp4";return t};var l=300;this.getNext=function(){var t=this.current+1;return l>=t?t:null},this.getPrevious=function(){var t=this.current-1;return t>=0?t:null},this.cache=[];var c="/wp/?json=get_category_posts&post_type=mm_annotation&slug=";this.getShot=function(t){var i=o.defer(),r="number"!=typeof t||isNaN(t)?this.current:t;if(this.cache[r])return i.resolve(this.cache[r]),i.promise;var l=c+n("shot")(r);return e({method:"GET",url:l}).success(function(t){s.cache[r]=a.parse(t.posts),i.resolve(s.cache[r])}).error(function(){i.reject("Error fetching shot "+r)}),i.promise};var d="/wp/?json=get_category_index";this.getThumbnails=function(t){var n=o.defer();return t=t||0,e({method:"GET",url:d+"&page="+t}).success(function(t){"ok"===t.status?(n.resolve(t.categories),l=parseInt(_.last(t.categories).slug,10)):n.reject("Error fetching shots")}).error(function(){n.reject("Error fetching shots")}),n.promise};var u="/wp/?json=get_tag_posts";this.getAnnotationsForTag=function(t,n){var i=o.defer();return n=n||0,e({method:"GET",url:u+"&id="+t.id+"&page="+n}).success(function(t){"ok"===t.status?i.resolve(t.posts):i.reject("Error fetching shots")}).error(function(){i.reject("Error fetching shots")}),i.promise};var h="/wp/?json=get_tag_index";this.getTags=function(t){var n=o.defer();return t=t||0,e({method:"GET",url:h+"&page="+t}).success(function(t){"ok"===t.status?n.resolve(t.tags):n.reject("Error fetching shots")}).error(function(){n.reject("Error fetching shots")}),n.promise},t.$on("$stateChangeStart",function(t,e,n){var i=parseInt(n.shot,10);!isNaN(i)&&i>=0&&l>=i&&(s.current=i)})}function AnnotationsService(t){this.parse=function(e){var n=[];return angular.forEach(e,function(e){n.push(new t(e))}),n}}function AnnotationParserService(t,e){this.parse=function(n){var i=[];return angular.forEach(n,function(n){var o=n.content,a=o.split(/\[slide\s*/gi);return a.length<2?(i.push({type:"text",content:o,attributes:{text:void 0},annotation:n}),!1):(a=a.slice(1),angular.forEach(a,function(a,s){var r=a.split("]");if(r.length<2)throw new Error('Slide tag "'+r[0]+'" did not have closing bracket: '+o);var l=r[0],c=r[1],d=/(\w+)(?=$|\s|=)/i,u=d.exec(l);if(null===u)throw new Error("Could not determine type of slide tag: "+a);u=u[1].toLowerCase();var h={text:1,background:1,photo:1,highlight:1,audio:1,video:1,streetview:1};if(!h[u])throw new Error("Type not allowed: "+u);var v={};l=l.replace(/&#8220;|&#8221;|&#8243;/g,'"'),l=l.replace(/&#8216;|&#8217;|&#8242;/g,"'"),l=l.replace(/&#8211;|&#8212;/g,"-");for(var p,g,m,f=/(\w+)=("[^"]*"|'[^']*'|\w+)/g,y=l;null!==(p=f.exec(l));)g=p[1].toLowerCase(),m=p[2],('"'===m.charAt(0)||"'"===m.charAt(0))&&(m=m.slice(1,-1)),"video"===g&&(m=m.split(",")),v[g]=m,y=y.replace(p[0],"");angular.forEach(y.split(/\s+/g),function(t){t&&(v[t]=void 0)}),v.caption&&(v.caption=v.caption.replace(/\<br\s*\/*\>/gi,"")),("photo"===u||"background"===u||"video"===u)&&(c=c.replace(/\<br\s*\/*\>/gi,""),"video"===u&&(c=c.replace(/width\=\"[0-9a-z]+\"/gi,""),c=c.replace(/height\=\"[0-9a-z]+\"/gi,"")));var w={type:u,content:t.trustAsHtml(c),attributes:v,annotation:n},b={photo:"photos",video:"video",streetview:"Then & Now"};0!==s||b[u]||i.push({type:"author",annotation:n}),b[u]&&(w.nav="video"===u&&v.title?v.title:b[u]),"video"===u&&(w.onEnter=function(){e.$broadcast("videoEnter",w)},w.onExit=function(){e.$broadcast("videoExit",w)}),i.push(w)}),void 0)}),i}}function Annotation(){function t(t){function e(t){var e=n&&n[t]&&n[t][0];return e||""}if(t){this.author={name:t.author&&t.author.name,image:"/wp/wp-content/uploads/authors/"+t.author.nickname+".jpg"},this.content=t.content||"";var n=t.custom_fields,i=e("mm_annotation_streetview"),o=e("mm_annotation_start_timecode"),a=e("mm_annotation_end_timecode"),s=e("mm_annotation_x"),r=e("mm_annotation_y");i&&(this.streetView=i),(o||a)&&(this.timecodes={start:o&&parseFloat(o)||0,end:a&&parseFloat(a)||0}),(s||r)&&(this.highlight={x:s&&parseFloat(s)||0,y:r&&parseFloat(r)||0});var l={};t.tags&&t.tags.length&&angular.forEach(t.tags,function(t){l[t.title]=1}),this.tags=l}}return t}function StreetViewService(){var t="//maps.googleapis.com/maps/api/streetview?",e="AIzaSyCru1EQFOIRQgaalFfc7TtJH0S6TosODQ4",n=e?"https:":"";this.parseStreetViewUrl=function(t,e){var n={size:e||"200x200",sensor:"false"},i=/www\.google\.com\/maps.*\/@([^\/]+)\//,o=i.exec(t);return o?(o=o[1].split(","),n.location=o[0]+","+o[1],n.fov=parseInt(o[3].replace("y",""),10),n.heading=parseFloat(o[4].replace("h","")),n.pitch=parseFloat(o[5].replace("t",""))-90,n):!1},this.buildStreetViewAPIUrl=function(i){var o=[];for(var a in i)o.push(a+"="+i[a]);return e&&o.push("key="+e),n+t+o.join("&")}}function VideoService(t){var e=document.createElement("canvas"),n=e.getContext("2d"),i=[],o=[];this.screenshotTaken=function(e){e=e||0;var n=t.current,o=i[n];return o&&o[e]};var a=function(t){var i=t.videoHeight,o=t.videoWidth;return e.height=i,e.width=o,n.drawImage(t,0,0),n.getImageData(0,0,o,i)};this.screenshot=function(e,n){var s=t.current,r=!i[s],l=i[s]||{};l[n]=a(e),i[s]=l;var c=o[s],d=c&&c[n];if(d&&d.length){for(;d.length;)d.pop()(l[n]);o[s][n]=null}r&&c&&_.forIn(c,function(t){_.forEach(t,function(t){t(l[n])})})},this.requestScreenshot=function(e,n){var a=t.current,s=i[a]||{};s[e]?n(s[e]):(o[a]=o[a]||{},o[a][e]=o[a][e]||[],o[a][e].push(n),s[0]?n(s[0]):_.forIn(s,function(t){return n(t),!1}))}}function ShotVideoService(){var t=this,e={start:0,end:0},n=e,i=!1,o=null;this.registerShotVideo=function(i){t.video&&t.video.removeEventListener("timeupdate",t.onTimeUpdate,!1),t.video=i,n=e,t.video.addEventListener("timeupdate",t.onTimeUpdate,!1)},this.play=function(e){t.video.readyState<2||(i=!0,o=e,t.video.currentTime=0,t.video.playbackRate=1,t.video.muted=!1,t.video.loop=!1,e&&t.video.addEventListener("ended",o,!1))},this.resumeLoop=function(){t.video.readyState<2||(i=!1,t.video.playbackRate=.3,t.video.muted=!0,t.video.loop=!0,t.video.removeEventListener("ended",o,!1),o=null,t.video.currentTime=0,t.video.play())},this.pause=function(){t.video.playbackRate=0},this.setLoopBounds=function(t){n=t||e},this.onTimeUpdate=function(){var e;if(!i&&(n.start||n.end)){e=t.video;var o=e.currentTime;n.start&&o<n.start?e.currentTime=n.start:n.end&&o>n.end&&(e.currentTime=n.start||0)}}}function ScrollService(t){var e={fadeInFromBottom:[{key:-1,opacity:0,top:1},{key:-.5,opacity:0,top:.5,ease:"out"},{key:0,opacity:1,top:0},{key:1,opacity:0,top:0}],slideInFromBottom:[{key:0,top:1,ease:"out"},{key:.8,top:0},{key:1.2,top:0,ease:"in"},{key:2,top:-1}],highlightStart:[{key:-.5,top:0,left:1,metaOpacity:0}],construct:function(t,e){return t=_.clone(t,!0),_.forEach(e,function(e){var n=_.find(t,{key:e.key});if(n)n=_.merge(n,e);else{var i=_.sortedIndex(t,e,"key");t.splice(i,0,e)}}),t}};this.init=function(t){this.$el=t.el,this.annotationInfo=[],this.height=window.innerHeight,this.navHeight=80,this.slides=[],this.$slides=[],this.headers=document.getElementsByClassName("top-nav-author"),this.navButtons=document.getElementsByClassName("side-nav-circle"),this.$background=angular.element(document.getElementsByClassName("shot-background")[0]),this.$play=angular.element(document.getElementsByClassName("shot-video-play")[0]),window.addEventListener("resize",angular.bind(this,this.sizeAndPosition)),this.boundOnscroll=angular.bind(this,this.onscroll),this.nextDraw()},this.keyFrames={introduction:[{key:0,backgroundOpacity:1,opacity:1,playOpacity:1},{key:.8,opacity:0,playOpacity:1},{key:.9,opacity:0,playOpacity:0},{key:1,backgroundOpacity:0,opacity:0,playOpacity:0}],outro:[{key:-.3,backgroundOpacity:1,opacity:0},{key:0,backgroundOpacity:0,opacity:0},{key:.5,opacity:1},{key:10,opacity:1}],shotvideo:[{key:0,backgroundOpacity:1},{key:.2,backgroundOpacity:0},{key:.8,backgroundOpacity:0},{key:1,backgroundOpacity:1}],author:[{key:0,opacity:0},{key:.5,opacity:1,left:0,top:0,scale:1},{key:1,left:0,top:0,scale:1,ease:"in-out"},{key:1.5,top:-.3,left:-.41,scale:.45}],background:[{key:-.5,top:1,ease:"out",metaOpacity:1},{key:.2,top:0,metaOpacity:1},{key:.9,metaOpacity:1},{key:1,top:0,metaOpacity:0}],"bg-video":[{key:-.5,top:1},{key:0,top:0},{key:2.5,top:0},{key:3,top:-1}],"main-title":{"slide-inner":{frames:[{key:-.9,top:1,ease:"out"},{key:-.3,top:0},{key:1.5,top:0},{key:2,top:-1}]},"slide-main-title-description":{frames:[{key:-.3,top:1,ease:"out"},{key:.3,top:0}]},"slide-main-title-subtitle":{frames:[{key:.3,top:1,ease:"out"},{key:.9,top:0}]},"slide-main-title-play":{frames:[{key:.3,top:1,ease:"out"},{key:.9,top:0}]}},text:e.fadeInFromBottom,highlight:e.highlightStart,photo:e.slideInFromBottom,streetview:e.slideInFromBottom,video:[{key:0,top:1,ease:"out"},{key:.5,top:0},{key:1,top:0},{key:1.5,top:-1}]},this.easing={linear:function(t){return t},"in":function(t){return t*t},out:function(t){return t*(t-2)*-1},"in-out":function(t){return t=2*t,1>t?t*t*.5:-.5*(--t*(t-2)-1)},"cube-in":function(t){return t*t*t},"cube-out":function(t){return(t-=1)*t*t+1}},this.setSlides=function(t){this.slides=t;var e=this;window.setTimeout(function(){e.$slides=e.$el[0].getElementsByClassName("slide"),e.sizeAndPosition()},100)},this.scrollToSlide=function(t){window.scrollTo(0,t.padded_top)},this.sizeAndPosition=function(){this.height=window.innerHeight,this.halfHeight=this.height/2,this.doubleHeight=2*this.height;var t,e,n=0,i=0,o=window.innerWidth,a=document.querySelector(".shot-video-directive"),s=a?a.clientWidth:o,r=s/o,l=(o-s)/2/o;0>l&&(l=0),!this.slides||this.slides.length<1||this.$slides.length<1||(angular.forEach(this.slides,function(o,a){var s=this.$slides[a];if(o.top=s.offsetTop,o.height=s.offsetHeight,o.bottom=o.top+o.height,o.padded_top="main-title"!==o.type?Math.round(o.top+(o.height-this.height)/2):o.bottom-this.height,o.el=s,o.$el=angular.element(s),o.$inner=o.$el.find("div").eq(0),o.$meta=angular.element(o.el.getElementsByClassName("meta-text")[0]),o.index=a,o.keyFrames=_.clone(this.keyFrames[o.type],!0)||[],_.isArray(o.keyFrames)||_.each(o.keyFrames,function(t,e){t.$el=angular.element(o.$el[0].getElementsByClassName(e))}),"highlight"===o.type){var c=o.annotation.highlight.x/100;c=l+c*r;var d=o.annotation.highlight.y/100;o.keyFrames=o.keyFrames.concat([{key:0,top:d,left:c,metaOpacity:0},{key:.2,top:d,left:c,metaOpacity:1},{key:.7,top:d,left:c,metaOpacity:1,opacity:1},{key:1,top:d,left:c,metaOpacity:0,opacity:0}])}(o.isHeader||"author"===o.type)&&(o.headerEl=this.headers[n],n++),o.isNav&&(o.navButton=this.navButtons[i],i++),t&&o.annotation!==t.annotation&&(t.keyFrames=t.keyFrames.concat([{key:a-t.index+.5,opacity:1,top:-.3,left:-.41,scale:.45},{key:a-t.index+1,opacity:0,top:-.3,left:-.41,scale:.45}]),t=null),"author"===o.type&&(t=o),e&&o.annotation!==e.annotation&&(e.keyFrames=e.keyFrames.concat([{key:a-e.index-1,opacity:1,top:0,metaOpacity:0},{key:a-e.index-.5,opacity:0,top:-1,metaOpacity:0}]),e=null),"background"===o.type&&(e=o)},this),this.lastY=void 0,this.reflow())},this.currentSlide={},this.currentAnnotation={},this.nextDraw=function(){this.animationFrame=window.requestAnimationFrame(this.boundOnscroll)},this.reflow=function(){window.cancelAnimationFrame(this.animationFrame),this.onscroll()},this.onscroll=function(){var e=window.scrollY;if(!this.slides||!this.slides.length||e===this.lastY||0>e)return this.nextDraw();this.lastY=e;var n=this.height;return angular.forEach(this.slides,function(i,o){var a=(e-i.top)/n,s=i.keyFrames;if(s){var r=_.isArray(s)?s:s["slide-inner"].frames,l=r.length,c=_.sortedIndex(r,{key:a},"key"),d=0===c&&a<r[0].key;if(d)return i.hidden||(i.$inner.css({display:"none"}),i.hidden=!0),void 0;var u=c===l&&a>r[l-1].key;if(u)return i.hidden||(i.$inner.css({display:"none"}),i.hidden=!0),void 0;if(i.hidden=!1,e>=i.top&&e<=i.bottom){this.currentSlide!==i&&(this.currentSlide.onExit&&this.currentSlide.onExit(),i.onEnter&&i.onEnter(),this.currentSlide=i,i.annotation&&this.currentAnnotation!==i.annotation&&(this.currentAnnotation=i.annotation,t.setLoopBounds(this.currentAnnotation.timecodes)));var h,v=i.headerEl,p=i.navButton;if(v||(h=this.slides.slice(0,o),_.forEachRight(h,function(t){return t.headerEl?(v=t.headerEl,!1):void 0})),p||(h=this.slides.slice(0,o),_.forEachRight(h,function(t){return t.navButton?(p=t.navButton,!1):void 0})),v&&(!this.lastHeader||this.lastHeader!==v)){var g;angular.forEach(this.headers,function(t){var e=angular.element(t);t===v?(g=e,e.removeClass("up").removeClass("down")):g?e.addClass("down").removeClass("up"):e.addClass("up").removeClass("down")},this),this.lastHeader=v}!p||this.lastNav&&this.lastNav===p||(this.lastNav&&angular.element(this.lastNav).removeClass("highlighted"),angular.element(p).addClass("highlighted"),this.lastNav=p)}var m,f,y,w={};y=_.isArray(s)?[{$el:i.$inner,frames:s}]:_.toArray(s),_.each(y,function(t){s=t.frames,_.forEach(s,function(t){if(a===t.key)return w=_.omit(t,["key","event"]),!1;if(!(a>t.key)){var e=(a-m)/(t.key-m),n=this.easing[f](e),i={};return _.forEach(t,function(t,e){"key"!==e&&"event"!==e&&void 0!==w[e]&&(i[e]=w[e]+(t-w[e])*n)}),w=i,!1}w=_.omit(t,["key","event"]),m=t.key,f=t.ease||"linear"},this);var e=0,n=0,o="";_.forEach(w,function(t,i){"top"===i?n=(t*this.height).toFixed(1)+"px":"left"===i?e=(100*t).toFixed(1)+"%":"scale"===i?o=" scale("+t.toFixed(2)+")":("opacity"===i||"backgroundOpacity"===i)&&(w[i]=t.toFixed(2))},this),t.$el[0]!==i.$inner[0]||_.has(w,"opacity")||(w.opacity=1);var r="translate3d("+e+", "+n+", 0)"+o;t.$el.css({"-webkit-transform":r,transform:r,display:"block",opacity:w.opacity}),void 0!==w.metaOpacity&&i.$meta.css({opacity:w.metaOpacity}),void 0!==w.backgroundOpacity&&this.$background.css({opacity:w.backgroundOpacity}),void 0!==w.playOpacity&&this.$play.css({opacity:w.playOpacity})},this)}},this),this.nextDraw()}}function AutoScrollerService(){function t(){var i=window.pageYOffset;if(null!==e&&i!==e&&i!==e-n)return e=null,void 0;var o=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight);return i+window.innerHeight>=o?(e=null,void 0):(e=i+n,window.scrollTo(0,e),window.requestAnimationFrame(t),void 0)}var e=null,n=5;this.autoScroll=function(){window.scrollTo(0,window.innerHeight/2),t()}}function AnalyticsService(t){this.pageview=function(e,n){t.ga&&t.ga("send","pageview",{page:e,title:n})}}function ShotFilter(t){return("0000"+t).slice(-4)}function MimeTypeFilter(t){return _.last(t.split("."))}function WebMFilter(t){return t.replace(".mp4",".webmhd.webm")}function SlideManager(t,e){return{restrict:"E",template:['<slide ng-class="{\'slides-loading\': loading}" ng-repeat="slide in slides" data="slide"></slide>'].join(""),scope:{slides:"=?"},link:function(n,i){e.init({el:i}),n.$watch("slides",function(){n.loading=!0,n.$evalAsync(function(){e.setSlides(n.slides),t(function(){n.loading=!1},100)})})}}}function Slide(){return{restrict:"E",templateUrl:"templates/slide.html",link:function(){}}}function BackgroundCoverDirective(t,e){return{restrict:"C",priority:-1,link:function(n,i,o){function a(){var t="IMG"===i[0].tagName?i[0]:i.find("IMG")[0];if(t&&t.height&&t.width){var e=window.innerWidth/window.innerHeight;return t.width/t.height>e&&o.$addClass("fill-height-directive"),"IMG"===i[0].tagName?i.off("load",a):i.find("IMG").off("load",a),!0}return!1}a()||("IMG"===i[0].tagName?i.on("load",a):o.ngBindHtml&&n.$watch("ngBindHtml",function(){t(function(){a()||i.find("IMG").on("load",a)},50)})),angular.element(e).on("resize",_.debounce(a,150))}}}function shotVideoDirective(t,e){return{restrict:"C",link:function(n,i){function o(){var e=parseFloat(a.currentTime.toFixed(1));if(s[e]){t.screenshot(a,e),delete s[e];var n=!1;_.forIn(s,function(t){return t?(n=!0,!1):void 0}),n||(a.removeEventListener("timeupdate",o),s=!1)}}var a=i[0];e.registerShotVideo(a),a.playbackRate=.3,t.screenshots=t.screenshots||{};var s;n.$watch("shot.annotations",function(){s=!1,_.forEach(n.shot.annotations,function(e){var n=e.timecodes,i=n&&void 0!==n.start;i&&!t.screenshotTaken(a,n.start)&&(s=s||{},s[n.start]=1)}),s&&a.addEventListener("timeupdate",o)})}}}function StreetView(t){return{restrict:"E",templateUrl:"templates/streetview.html",scope:{url:"@",caption:"@",title:"@",startFrame:"@"},link:function(e){var n=window.innerWidth+"x"+window.innerHeight,i=t.parseStreetViewUrl(e.url,n);e.streetViewImageUrl=t.buildStreetViewAPIUrl(i),e.oneUp=!0,e.goToStreetView=function(){}}}}function VideoFrame(t){return{restrict:"A",scope:{target:"@"},link:function(e,n){var i=e.target||0,o=n[0],a=o.getContext("2d"),s=function(t){o.height=t.height,o.width=t.width,a.putImageData(t,0,0,0,0,t.width,t.height)};t.requestScreenshot(i,s)}}}function FitToWindowDirective(t,e){return{restrict:"C",priority:-1,link:function(n,i,o){function a(){var t,n,l,c=e.innerWidth/e.innerHeight;r?(l=i.find("IMG")[0],t=l&&l.height,n=l&&l.width):"VIDEO"===s.tagName?(t=s.videoHeight,n=s.videoWidth):"IMG"===s.tagName&&(t=s.height,n=s.width),t&&n&&(n/t>c?o.$addClass("fit-to-window-width-directive"):o.$removeClass("fit-to-window-width-directive"),r?i.find("IMG").off("load",a):i.off("load",a))}var s=i[0],r=o.ngBindHtml;r?n.$watch("ngBindHtml",function(){t(function(){i.find("IMG").on("load",a),a()},50)}):i.on("load",a),a(),angular.element(e).on("resize",_.debounce(a,150))}}}function VideoContainer(t){return{restrict:"A",link:function(e,n){function i(){var t;switch(s){case"html5":t=n.find("video")[0];break;case"vimeo":t=n.find("iframe")[0];break;case"youtube":t=n.find("iframe")[0]}return t}var o=n[0],a=(angular.element(o),e.slide),s="",r=!1;a.attributes.video?s="html5":a.annotation.content.indexOf("vimeo")>=0?s="vimeo":a.annotation.content.indexOf("youtube")>=0&&(s="youtube"),t.$on("videoEnter",function(t,e){e===a&&("html5"!==s||r||(i().play(),r=!0))}),t.$on("videoExit",function(t,e){if(e===a&&"html5"===s){var n=i();n.pause()}})}}}angular.module("shotbyshot",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router"]).config(["$stateProvider","$urlRouterProvider","$sceDelegateProvider",function(t,e,n){t.state("shot",{url:"/:shot",templateUrl:"partials/shot.html",controller:"ShotCtrl",controllerAs:"shot"}),e.otherwise("/0001"),n.resourceUrlWhitelist(["self","http://www.memory.lossur.es/wp/wp-content/uploads/**","player.vimeo.com/video/**","http://cf.lossur.es/**","http://d16hdktz6rtx08.cloudfront.net/**"])}]),ShotCtrl.$inject=["$scope","$sce","$filter","$timeout","$state","ShotService","AnnotationParserService","ShotVideoService","ScrollService","AnalyticsService","AutoScrollerService"],angular.module("shotbyshot").controller("ShotCtrl",ShotCtrl),ShotService.$inject=["$rootScope","$http","$filter","$stateParams","$q","AnnotationsService"],angular.module("shotbyshot").service("ShotService",ShotService),AnnotationsService.$inject=["Annotation"],angular.module("shotbyshot").service("AnnotationsService",AnnotationsService),AnnotationParserService.$inject=["$sce","$rootScope","Annotation"],angular.module("shotbyshot").service("AnnotationParserService",AnnotationParserService),angular.module("shotbyshot").factory("Annotation",Annotation),angular.module("shotbyshot").service("StreetViewService",StreetViewService),VideoService.$inject=["ShotService"],angular.module("shotbyshot").service("VideoService",VideoService),angular.module("shotbyshot").service("ShotVideoService",ShotVideoService),ScrollService.$inject=["ShotVideoService"],angular.module("shotbyshot").service("ScrollService",ScrollService),angular.module("shotbyshot").service("AutoScrollerService",AutoScrollerService),AnalyticsService.$inject=["$window"],angular.module("shotbyshot").service("AnalyticsService",AnalyticsService),angular.module("shotbyshot").filter("shot",function(){return ShotFilter}),angular.module("shotbyshot").filter("mimetype",function(){return MimeTypeFilter}),angular.module("shotbyshot").filter("webm",function(){return WebMFilter}),SlideManager.$inject=["$timeout","ScrollService"],angular.module("shotbyshot").directive("slideManager",SlideManager),angular.module("shotbyshot").directive("slide",Slide),BackgroundCoverDirective.$inject=["$timeout","$window"],angular.module("shotbyshot").directive("backgroundCoverDirective",BackgroundCoverDirective),shotVideoDirective.$inject=["VideoService","ShotVideoService"],angular.module("shotbyshot").directive("shotVideoDirective",shotVideoDirective),StreetView.$inject=["StreetViewService"],angular.module("shotbyshot").directive("streetView",StreetView),VideoFrame.$inject=["VideoService"],angular.module("shotbyshot").directive("videoFrame",VideoFrame),FitToWindowDirective.$inject=["$timeout","$window"],angular.module("shotbyshot").directive("fitToWindowDirective",FitToWindowDirective),VideoContainer.$inject=["$rootScope"],angular.module("shotbyshot").directive("videoContainer",VideoContainer),function(t){try{t=angular.module("shotbyshot")}catch(e){t=angular.module("shotbyshot",[])}t.run(["$templateCache",function(t){t.put("partials/nav.html",'<nav class="top-nav" ng-class="{menu: menuIsOn && !globalIsOn, global: globalIsOn}">\n    <button class="top-nav-menu-button" ng-click="toggleGlobalMenu()"></button>\n    <div class="top-nav-current-slide" ng-click="toggleMenu()">\n        <div class="top-nav-author down" ng-repeat="slide in shot.slides | filter:isHeaderSlide">\n          {{ slide.nav || slide.annotation.author.name }}\n        </div>\n        <div class="top-nav-index-label">Shot by Shot Index</div>\n        <button class="top-nav-shots-button"></button>\n    </div>\n    <div class="top-nav-shot" ng-show="shot.id">\n        <a ng-show="shot.previous" ui-sref="shot({ shot: shot.previous })" class="top-nav-shot-down"></a>\n        <div class="top-nav-shot-current">{{ shot.id }}</div>\n        <a ng-show="shot.next" ui-sref="shot({ shot: shot.next })" class="top-nav-shot-up"></a>\n    </div>\n\n    <div class="nav-menu">\n      <div class="nav-menu-controls">\n        <div class="nav-menu-tabs">\n          <a class="nav-menu-tab" ng-repeat="tab in [\'shots\', \'tags\']" ng-click="$parent.showMenuTab = tab; $parent.filterShots();" ng-bind="tab" ng-class="{on: showMenuTab === tab}"></a>\n        </div>\n      </div>\n\n      <div class="nav-menu-shots" ng-show="showMenuTab === \'shots\'">\n        <div class="nav-menu-scrollable">\n          <a class="nav-menu-shot" ng-repeat="shot in thumbs" ui-sref="shot({ shot: shot.slug })" ng-style="{\'background-image\': \'url(\' + thumbnailForShot(shot) + \')\'}">\n            <div class="nav-menu-shot-number">{{ shot.slug | number }}</div>\n          </a>\n        </div>\n      </div>\n\n      <div class="nav-menu-tags" ng-show="showMenuTab === \'tags\'">\n        <div class="nav-menu-scrollable">\n          <a class="nav-menu-tag" ng-repeat="tag in shot.tags" ng-bind-html="tag.title" ng-click="$parent.filterShots(tag); $parent.showMenuTab = \'shots\';"></a>\n        </div>\n      </div>\n    </div>\n\n    <div class="nav-global">\n      <div>living <strong>los sures</strong></div>\n      <div><a href="http://89.lossur.es">89 Steps</a></div>\n      <div><a href="#/0001">Shot by Shot</a></div>\n      <div><a href="http://lossur.es/short-docs/">Southside Short Docs</a></div>\n\n      <div class="nav-global-subscribe">\n        <form action="http://ymlp.com/subscribe.php?id=gumhejygmgb" method="post">\n          <input type="email" name="YMP0" placeholder="your email address">\n          <input type="submit" value="Submit" style="display: none;">\n        </form>\n      </div>\n\n      <div class="copyright">© <strong>UnionDocs, Inc.</strong> 2014</div>\n    </div>\n</nav>\n\n<nav class="side-nav">\n    <ul class="side-nav-circles">\n      <li class="side-nav-circle" ng-repeat="slide in shot.slides | filter:isNavSlide" ng-click="scrollToSlide(slide)">\n        <div class="side-nav-tag">{{ slide.nav || slide.annotation.author.name }}</div>\n      </li>\n    </ul>\n</nav>\n\n')}])}(),function(t){try{t=angular.module("shotbyshot")}catch(e){t=angular.module("shotbyshot",[])}t.run(["$templateCache",function(t){t.put("partials/shot.html",'<div class="container">\n    <div ng-class="{\'cinema\': shot.playing}" ng-include="\'partials/nav.html\'"></div>\n\n    <div class="content" ng-class="{\'shot-ready\': shot.ready, \'cinema\': shot.playing}">\n\n        <div class="shot-background" ng-style="{\'opacity\': shot.backgroundOpacity}"></div>\n\n        <video class="shot-video-directive" crossorigin autoplay loop muted>\n            <source ng-src="{{ shot.videoUrl }}" type="video/mp4">\n            <source ng-src="{{ shot.videoUrl | webm }}" type="video/webm">\n            Your browser does not support the <code>video</code> element.\n        </video>\n\n        <div class="shot-video-play" ng-show="shot.ready && inView && !shot.playing" ng-click="shot.play()"></div>\n\n        <div class="slides">\n            <slide-manager slides="shot.slides"></slide-manager>\n        </div>\n    </div>\n</div>\n')}])}();